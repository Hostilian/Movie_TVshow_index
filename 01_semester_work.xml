<?xml version="1.0" encoding="UTF-8"?>
<!--
============================================================
    MOVIE DATABASE - XML SEMESTER WORK FILE
    Database Systems (EIE36E) Project

    BIE-DBS Cookbook Compliant

    Student: Ozturk Eren
    Login: xkonj108
    Database: xkonj108
    Server: db.kii.pef.czu.cz
    Date: 2025-11-29
============================================================
-->
<semester_work>
    <!-- ========================================== -->
    <!-- METADATA SECTION -->
    <!-- ========================================== -->
    <metadata>
        <student_name>Ozturk Eren</student_name>
        <student_login>xozte001</student_login>
        <project_title>Movie and TV Database Management System</project_title>
        <database_server>db.kii.pef.czu.cz</database_server>
        <database_name>xozte001</database_name>
        <submission_date>2025-11-29</submission_date>
        <course>EIE36E - Database Systems</course>
        <instructor>Ing. Josef Pavlíček Ph.D.</instructor>
        <data_source>OMDb API (https://www.omdbapi.com/)</data_source>
        <api_key>11888daa</api_key>
    </metadata>

    <!-- ========================================== -->
    <!-- FIRST ITERATION: Title + Description (>=200 words) + 3 Queries -->
    <!-- Requirement: 5 points -->
    <!-- ========================================== -->
    <first_iteration>
        <title>Movie and TV Database Management System</title>

        <description word_count="285">
            This comprehensive database system is designed to manage and organize detailed
            information about movies and television productions from around the world. The
            system serves as a centralized repository for film metadata, enabling users to
            explore relationships between movies, their cast members, directors, genres,
            and production details.

            The primary purpose of this database is to support a movie information platform
            similar to IMDb, providing functionality for movie discovery, cast analysis,
            genre exploration, and ratings aggregation. Users can search for films by
            various criteria including title, release year, genre, actor, or director.
            The system tracks many-to-many relationships between movies and actors, as
            well as movies and genres, reflecting the real-world complexity of film
            production.

            Key features include storage of movie ratings from both IMDb and user-submitted
            reviews, allowing for comprehensive quality assessment. The database also
            maintains information about production studios and countries of origin,
            supporting analysis of international co-productions and studio output patterns.

            Data is sourced from the OMDb API (Open Movie Database), which provides
            reliable, well-structured movie metadata including titles, release dates,
            runtime, plot summaries, cast lists, and ratings. This ensures the database
            contains realistic, verifiable information rather than fabricated test data.

            The system architecture follows best practices in relational database design,
            implementing proper normalization to Third Normal Form (3NF), establishing
            referential integrity through foreign key constraints, and utilizing indexes
            for query optimization. The design specifically avoids circular dependencies
            to ensure clean query paths and straightforward data maintenance operations.
        </description>

        <!-- 3 Queries in Common Language (Category C - Simple) -->
        <queries_common_language>
            <query id="1" category="C">
                Find all movies that were released after the year 2010.
            </query>
            <query id="2" category="C">
                Show the title and IMDb rating for all movies in the database.
            </query>
            <query id="3" category="C">
                List all actors who were born before 1970.
            </query>
        </queries_common_language>
    </first_iteration>

    <!-- ========================================== -->
    <!-- SECOND ITERATION: Schema (>=8 entities) + Loops + 10 Queries -->
    <!-- Requirement: 15 points -->
    <!-- ========================================== -->
    <second_iteration>
        <!-- 8 PRIMARY ENTITIES (binding entities excluded from count) -->
        <entities count="8">
            <entity id="E1" name="DIRECTOR" type="primary">
                <description>Stores information about film directors including name and birth year</description>
                <attributes>
                    <attribute name="director_id" type="SERIAL" pk="true">Unique identifier</attribute>
                    <attribute name="name" type="VARCHAR(100)" nullable="false">Director full name</attribute>
                    <attribute name="birth_year" type="INTEGER">Year of birth</attribute>
                    <attribute name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP">Record timestamp</attribute>
                </attributes>
            </entity>

            <entity id="E2" name="ACTOR" type="primary">
                <description>Stores information about film actors</description>
                <attributes>
                    <attribute name="actor_id" type="SERIAL" pk="true">Unique identifier</attribute>
                    <attribute name="name" type="VARCHAR(100)" nullable="false">Actor full name</attribute>
                    <attribute name="birth_year" type="INTEGER">Year of birth</attribute>
                    <attribute name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP">Record timestamp</attribute>
                </attributes>
            </entity>

            <entity id="E3" name="GENRE" type="primary">
                <description>Stores film genre categories</description>
                <attributes>
                    <attribute name="genre_id" type="SERIAL" pk="true">Unique identifier</attribute>
                    <attribute name="genre_name" type="VARCHAR(50)" nullable="false" unique="true">Genre name</attribute>
                    <attribute name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP">Record timestamp</attribute>
                </attributes>
            </entity>

            <entity id="E4" name="COUNTRY" type="primary">
                <description>Stores country information for production origins</description>
                <attributes>
                    <attribute name="country_id" type="SERIAL" pk="true">Unique identifier</attribute>
                    <attribute name="country_name" type="VARCHAR(100)" nullable="false" unique="true">Country name</attribute>
                    <attribute name="country_code" type="CHAR(2)" unique="true">ISO code</attribute>
                    <attribute name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP">Record timestamp</attribute>
                </attributes>
            </entity>

            <entity id="E5" name="STUDIO" type="primary">
                <description>Stores production studio/company information</description>
                <attributes>
                    <attribute name="studio_id" type="SERIAL" pk="true">Unique identifier</attribute>
                    <attribute name="studio_name" type="VARCHAR(100)" nullable="false" unique="true">Studio name</attribute>
                    <attribute name="founded_year" type="INTEGER">Year founded</attribute>
                    <attribute name="country_id" type="INTEGER" fk="COUNTRY.country_id">HQ country</attribute>
                    <attribute name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP">Record timestamp</attribute>
                </attributes>
            </entity>

            <entity id="E6" name="MOVIE" type="primary" central="true">
                <description>Central entity storing core movie information</description>
                <attributes>
                    <attribute name="movie_id" type="SERIAL" pk="true">Unique identifier</attribute>
                    <attribute name="imdb_id" type="VARCHAR(20)" unique="true">IMDb reference ID</attribute>
                    <attribute name="title" type="VARCHAR(200)" nullable="false">Movie title</attribute>
                    <attribute name="year" type="INTEGER" nullable="false">Release year</attribute>
                    <attribute name="runtime" type="INTEGER">Duration in minutes</attribute>
                    <attribute name="imdb_rating" type="DECIMAL(3,1)">IMDb rating 0-10</attribute>
                    <attribute name="imdb_votes" type="INTEGER" default="0">Vote count</attribute>
                    <attribute name="plot" type="TEXT">Synopsis</attribute>
                    <attribute name="box_office" type="VARCHAR(50)">Revenue</attribute>
                    <attribute name="release_date" type="DATE">Release date</attribute>
                    <attribute name="director_id" type="INTEGER" nullable="false" fk="DIRECTOR.director_id">Director FK</attribute>
                    <attribute name="studio_id" type="INTEGER" fk="STUDIO.studio_id">Studio FK</attribute>
                    <attribute name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP">Record timestamp</attribute>
                </attributes>
            </entity>

            <entity id="E7" name="USER_RATING" type="primary">
                <description>Stores user-submitted ratings and reviews</description>
                <attributes>
                    <attribute name="rating_id" type="SERIAL" pk="true">Unique identifier</attribute>
                    <attribute name="movie_id" type="INTEGER" nullable="false" fk="MOVIE.movie_id">Movie FK</attribute>
                    <attribute name="user_name" type="VARCHAR(100)" nullable="false">Reviewer name</attribute>
                    <attribute name="rating_value" type="INTEGER" nullable="false" check="1-10">Rating score</attribute>
                    <attribute name="review_text" type="TEXT">Written review</attribute>
                    <attribute name="rating_date" type="TIMESTAMP" default="CURRENT_TIMESTAMP">Review date</attribute>
                </attributes>
            </entity>

            <entity id="E8" name="AWARD" type="primary">
                <description>Stores awards and nominations received by movies</description>
                <attributes>
                    <attribute name="award_id" type="SERIAL" pk="true">Unique identifier</attribute>
                    <attribute name="award_name" type="VARCHAR(100)" nullable="false">Award name (Oscar, BAFTA)</attribute>
                    <attribute name="category" type="VARCHAR(100)">Award category</attribute>
                    <attribute name="year_awarded" type="INTEGER">Year received</attribute>
                    <attribute name="movie_id" type="INTEGER" nullable="false" fk="MOVIE.movie_id">Movie FK</attribute>
                    <attribute name="is_winner" type="BOOLEAN" default="false">Won or nominated</attribute>
                    <attribute name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP">Record timestamp</attribute>
                </attributes>
            </entity>
        </entities>

        <!-- BINDING ENTITIES (M:N relationships - do NOT count toward 8) -->
        <binding_entities>
            <entity id="B1" name="MOVIE_ACTOR" type="binding">
                <description>M:N relationship between movies and actors</description>
                <attributes>
                    <attribute name="movie_id" type="INTEGER" pk="true" fk="MOVIE.movie_id"/>
                    <attribute name="actor_id" type="INTEGER" pk="true" fk="ACTOR.actor_id"/>
                    <attribute name="role_type" type="VARCHAR(20)" default="supporting" check="lead,supporting"/>
                </attributes>
            </entity>

            <entity id="B2" name="MOVIE_GENRE" type="binding">
                <description>M:N relationship between movies and genres</description>
                <attributes>
                    <attribute name="movie_id" type="INTEGER" pk="true" fk="MOVIE.movie_id"/>
                    <attribute name="genre_id" type="INTEGER" pk="true" fk="GENRE.genre_id"/>
                </attributes>
            </entity>

            <entity id="B3" name="MOVIE_COUNTRY" type="binding">
                <description>M:N relationship for international co-productions</description>
                <attributes>
                    <attribute name="movie_id" type="INTEGER" pk="true" fk="MOVIE.movie_id"/>
                    <attribute name="country_id" type="INTEGER" pk="true" fk="COUNTRY.country_id"/>
                </attributes>
            </entity>
        </binding_entities>

        <!-- LOOPS DISCUSSION (Required by BIE-DBS Cookbook) -->
        <loops_discussion>
            <statement>
                There are NO circular dependencies (loops) in this database model.
                The relationship graph is strictly acyclic.
            </statement>
            <analysis>
                The dependency flow is unidirectional:

                Level 0 (Independent): DIRECTOR, ACTOR, GENRE, COUNTRY
                Level 1 (Depends on Level 0): STUDIO references COUNTRY
                Level 2 (Depends on Level 0-1): MOVIE references DIRECTOR and STUDIO
                Level 3 (Depends on Level 2): USER_RATING and AWARD reference MOVIE
                Binding Tables: MOVIE_ACTOR, MOVIE_GENRE, MOVIE_COUNTRY connect entities

                No entity at any level references back to a higher level, therefore
                no circular dependency exists in this model.
            </analysis>
            <benefits>
                - No infinite loops during recursive queries
                - Clean CASCADE DELETE behavior
                - Unambiguous JOIN paths
                - Simplified transaction management
            </benefits>
        </loops_discussion>

        <!-- 10 Queries in Common Language (Categories C, D1, D2 as required) -->
        <queries_common_language count="10">
            <!-- Category C: Simple Selection/Projection (minimum 3 required) -->
            <query id="1" category="C">
                Find all movies released after the year 2010.
            </query>
            <query id="2" category="C">
                Show only the title and IMDb rating of all movies.
            </query>
            <query id="3" category="C">
                List all actors born before 1970.
            </query>

            <!-- Category D1: Joins (minimum 3 required) -->
            <query id="4" category="D1">
                List all movies together with their director names.
            </query>
            <query id="5" category="D1">
                Find all actors who appeared in the movie "Inception".
            </query>
            <query id="6" category="D1">
                Show all movies that belong to the "Action" genre.
            </query>
            <query id="7" category="D1">
                List all user reviews for movies directed by Christopher Nolan.
            </query>

            <!-- Category D2: Aggregations/Grouping (minimum 3 required) -->
            <query id="8" category="D2">
                Count the total number of movies in the database.
            </query>
            <query id="9" category="D2">
                Find the average IMDb rating of all movies.
            </query>
            <query id="10" category="D2">
                Show how many movies each director has directed, sorted by count.
            </query>
        </queries_common_language>
    </second_iteration>

    <!-- ========================================== -->
    <!-- RELATIONSHIPS -->
    <!-- ========================================== -->
    <relationships>
        <relationship name="directs" type="1:N" from="DIRECTOR" to="MOVIE">
            One director directs many movies; each movie has one director.
        </relationship>
        <relationship name="produces" type="1:N" from="STUDIO" to="MOVIE">
            One studio produces many movies; each movie has one primary studio.
        </relationship>
        <relationship name="headquartered_in" type="N:1" from="STUDIO" to="COUNTRY">
            Many studios can be in one country; each studio is in one country.
        </relationship>
        <relationship name="receives_rating" type="1:N" from="MOVIE" to="USER_RATING">
            One movie receives many ratings; each rating is for one movie.
        </relationship>
        <relationship name="wins_award" type="1:N" from="MOVIE" to="AWARD">
            One movie can win many awards; each award belongs to one movie.
        </relationship>
        <relationship name="acts_in" type="M:N" from="ACTOR" to="MOVIE" via="MOVIE_ACTOR">
            Many actors appear in many movies (resolved via MOVIE_ACTOR).
        </relationship>
        <relationship name="has_genre" type="M:N" from="MOVIE" to="GENRE" via="MOVIE_GENRE">
            Many movies have many genres (resolved via MOVIE_GENRE).
        </relationship>
        <relationship name="produced_in" type="M:N" from="MOVIE" to="COUNTRY" via="MOVIE_COUNTRY">
            Many movies produced in many countries (resolved via MOVIE_COUNTRY).
        </relationship>
    </relationships>

    <!-- ========================================== -->
    <!-- FOREIGN KEYS SUMMARY -->
    <!-- ========================================== -->
    <foreign_keys>
        <fk table="STUDIO" column="country_id" references="COUNTRY(country_id)" on_delete="SET NULL"/>
        <fk table="MOVIE" column="director_id" references="DIRECTOR(director_id)" on_delete="RESTRICT"/>
        <fk table="MOVIE" column="studio_id" references="STUDIO(studio_id)" on_delete="SET NULL"/>
        <fk table="USER_RATING" column="movie_id" references="MOVIE(movie_id)" on_delete="CASCADE"/>
        <fk table="AWARD" column="movie_id" references="MOVIE(movie_id)" on_delete="CASCADE"/>
        <fk table="MOVIE_ACTOR" column="movie_id" references="MOVIE(movie_id)" on_delete="CASCADE"/>
        <fk table="MOVIE_ACTOR" column="actor_id" references="ACTOR(actor_id)" on_delete="CASCADE"/>
        <fk table="MOVIE_GENRE" column="movie_id" references="MOVIE(movie_id)" on_delete="CASCADE"/>
        <fk table="MOVIE_GENRE" column="genre_id" references="GENRE(genre_id)" on_delete="CASCADE"/>
        <fk table="MOVIE_COUNTRY" column="movie_id" references="MOVIE(movie_id)" on_delete="CASCADE"/>
        <fk table="MOVIE_COUNTRY" column="country_id" references="COUNTRY(country_id)" on_delete="CASCADE"/>
    </foreign_keys>
</semester_work>
